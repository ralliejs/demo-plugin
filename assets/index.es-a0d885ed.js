function T(t,o,c,l){return new(c||(c=Promise))(function(H,y){function v(s){try{u(l.next(s))}catch(i){y(i)}}function A(s){try{u(l.throw(s))}catch(i){y(i)}}function u(s){var i;s.done?H(s.value):(i=s.value,i instanceof c?i:new c(function(w){w(i)})).then(v,A)}u((l=l.apply(t,o||[])).next())})}const E=t=>`[@rallie/load-html] ${t}`,k=/^(http:\/\/|https:\/\/|\/\/)([^?#]*)(\?[^?#]+)?(#.+)?/,C=t=>E(`Invalid html path: ${t}`),P=(t,o)=>E(`Can not construct a url by the base '${t}' and the path '${o}'`),L=t=>{const o=Array.from(t.attributes),c=document.createElement(t.tagName);return o.forEach(l=>{c.setAttribute(l.name,l.value)}),c.innerHTML=t.innerHTML,c},R=(t={})=>(o,c)=>T(void 0,void 0,void 0,function*(){var l;const H=(l=t.fetch)!==null&&l!==void 0?l:window.fetch,y=t.filter;o.loadHtml=A=>T(void 0,void 0,void 0,function*(){var u;const s=(u=t.regardHtmlPathAsRoot)!==null&&u!==void 0&&u,i=yield H(A),w=yield i.text(),[$,x]=(e=>{const r=k.exec(e);if(r)return[r[0],r[4]||null];throw new Error(C(e))})(A),{root:b,scripts:S,links:q,styles:M}=((e,r,d,h=()=>!0)=>{const a=document.createElement("html");a.innerHTML=e;const m=Array.from(a.querySelectorAll("script")).filter(h).map(n=>L(n)).map(n=>{const p=n.getAttribute("src");return d&&p&&n.setAttribute("src",d(p)),n}),g=Array.from(a.querySelectorAll("link")).filter(h).map(n=>L(n)).map(n=>{const p=n.getAttribute("href");return d&&p&&n.setAttribute("href",d(p)),n}),f=Array.from(a.querySelectorAll("style")).filter(h).map(n=>L(n));return{root:r?a.querySelector(r):null,scripts:m,links:g,styles:f}})(w,x,e=>((r,d,h=!1)=>{if(/^(http:\/\/|https:\/\/|\/\/).+/.test(r))return r;const a=k.exec(d);if(a){const m=a[1],g=a[2];h&&r.startsWith("/")&&(r=r.slice(1));let f="";return f=new URL(r,(m==="//"?"http://":m)+g).href,m==="//"&&(f=f.slice(5)),f}return console.error(P(d,r)),""})(e,$,s),y);for(const e of M)document.head.appendChild(e);for(const e of q)o.loadLink(e);if(b){const e=document.querySelector(x);e?e.innerHTML=b.innerHTML:document.body.appendChild(b)}for(const e of S)yield o.loadScript(e);return!!(S.length+q.length+M.length)||!!b});const v=(t.entries||{})[o.name];v?yield o.loadHtml(v):yield c()});export{R as default,R as loadHtml};
