(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();const ie="modulepreload",se=function(e,t){return new URL(e,t).href},At={},B=function(t,r,n){if(!r||r.length===0)return t();const i=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=se(s,n),s in At)return;At[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!n)for(let u=i.length-1;u>=0;u--){const p=i[u];if(p.href===s&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":ie,o||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),o)return new Promise((u,p)=>{l.addEventListener("load",u),l.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};function oe(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(l){try{h(n.next(l))}catch(u){s(u)}}function a(l){try{h(n.throw(l))}catch(u){s(u)}}function h(l){var u;l.done?i(l.value):(u=l.value,u instanceof r?u:new r(function(p){p(u)})).then(o,a)}h((n=n.apply(e,t||[])).next())})}function f(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function T(e,t,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(e,r):i?i.value=r:t.set(e,r),r}function S(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(l){try{h(n.next(l))}catch(u){s(u)}}function a(l){try{h(n.throw(l))}catch(u){s(u)}}function h(l){var u;l.done?i(l.value):(u=l.value,u instanceof r?u:new r(function(p){p(u)})).then(o,a)}h((n=n.apply(e,t||[])).next())})}function c(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function W(e,t,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(e,r):i?i.value=r:t.set(e,r),r}const ae=Object.assign,ce=Object.prototype.hasOwnProperty,it=(e,t)=>ce.call(e,t),L=Array.isArray,et=e=>Ct(e)==="[object Map]",_t=e=>typeof e=="symbol",ot=e=>e!==null&&typeof e=="object",le=Object.prototype.toString,Ct=e=>le.call(e),he=e=>Ct(e).slice(8,-1),bt=e=>typeof e=="string"&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Dt=(e,t)=>!Object.is(e,t),ue=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let fe;function Vt(e,t=fe){t&&t.active&&t.effects.push(e)}const Gt=e=>{const t=new Set(e);return t.w=0,t.n=0,t},Ft=e=>(e.w&O)>0,Kt=e=>(e.n&O)>0,ut=new WeakMap;let I=0,O=1;const ft=30;let b;const $=Symbol(""),dt=Symbol("");class de{constructor(t,r=null,n){this.fn=t,this.scheduler=r,this.active=!0,this.deps=[],this.parent=void 0,Vt(this,n)}run(){if(!this.active)return this.fn();let t=b,r=x;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=b,b=this,x=!0,O=1<<++I,I<=ft?(({deps:n})=>{if(n.length)for(let i=0;i<n.length;i++)n[i].w|=O})(this):Ot(this),this.fn()}finally{I<=ft&&(n=>{const{deps:i}=n;if(i.length){let s=0;for(let o=0;o<i.length;o++){const a=i[o];Ft(a)&&!Kt(a)?a.delete(n):i[s++]=a,a.w&=~O,a.n&=~O}i.length=s}})(this),O=1<<--I,b=this.parent,x=r,this.parent=void 0,this.deferStop&&this.stop()}}stop(){b===this?this.deferStop=!0:this.active&&(Ot(this),this.onStop&&this.onStop(),this.active=!1)}}function Ot(e){const{deps:t}=e;if(t.length){for(let r=0;r<t.length;r++)t[r].delete(e);t.length=0}}let x=!0;const Lt=[];function g(e,t,r){if(x&&b){let n=ut.get(e);n||ut.set(e,n=new Map);let i=n.get(r);i||n.set(r,i=Gt()),function(s,o){let a=!1;I<=ft?Kt(s)||(s.n|=O,a=!Ft(s)):a=!s.has(b),a&&(s.add(b),b.deps.push(s))}(i)}}function P(e,t,r,n,i,s){const o=ut.get(e);if(!o)return;let a=[];if(t==="clear")a=[...o.values()];else if(r==="length"&&L(e)){const h=ue(n);o.forEach((l,u)=>{(u==="length"||u>=h)&&a.push(l)})}else switch(r!==void 0&&a.push(o.get(r)),t){case"add":L(e)?bt(r)&&a.push(o.get("length")):(a.push(o.get($)),et(e)&&a.push(o.get(dt)));break;case"delete":L(e)||(a.push(o.get($)),et(e)&&a.push(o.get(dt)));break;case"set":et(e)&&a.push(o.get($))}if(a.length===1)a[0]&&Pt(a[0]);else{const h=[];for(const l of a)l&&h.push(...l);Pt(Gt(h))}}function Pt(e,t){const r=L(e)?e:[...e];for(const n of r)n.computed&&Mt(n);for(const n of r)n.computed||Mt(n)}function Mt(e,t){(e!==b||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const pe=function(e,t){const r=Object.create(null),n=e.split(",");for(let i=0;i<n.length;i++)r[n[i]]=!0;return t?i=>!!r[i.toLowerCase()]:i=>!!r[i]}("__proto__,__v_isRef,__isVue"),qt=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(_t)),we=Ht(),ve=Ht(!0),Wt=function(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...r){const n=d(this);for(let s=0,o=this.length;s<o;s++)g(n,"get",s+"");const i=n[t](...r);return i===-1||i===!1?n[t](...r.map(d)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...r){Lt.push(x),x=!1;const n=d(this)[t].apply(this,r);return function(){const i=Lt.pop();x=i===void 0||i}(),n}}),e}();function Ht(e=!1,t=!1){return function(r,n,i){if(n==="__v_isReactive")return!e;if(n==="__v_isReadonly")return e;if(n==="__v_isShallow")return t;if(n==="__v_raw"&&i===(e?t?Ae:Xt:t?Re:Qt).get(r))return r;const s=L(r);if(!e&&s&&it(Wt,n))return Reflect.get(Wt,n,i);const o=Reflect.get(r,n,i);return(_t(n)?qt.has(n):pe(n))?o:(e||g(r,"get",n),t?o:z(o)?s&&bt(n)?o:o.value:ot(o)?e?H(o):St(o):o)}}const me={get:we,set:function(e=!1){return function(t,r,n,i){let s=t[r];if(pt(s)&&z(s)&&!z(n))return!1;if(!e&&(function(h){return!(!h||!h.__v_isShallow)}(n)||pt(n)||(s=d(s),n=d(n)),!L(t)&&z(s)&&!z(n)))return s.value=n,!0;const o=L(t)&&bt(r)?Number(r)<t.length:it(t,r),a=Reflect.set(t,r,n,i);return t===d(i)&&(o?Dt(n,s)&&P(t,"set",r,n):P(t,"add",r,n)),a}}(),deleteProperty:function(e,t){const r=it(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&r&&P(e,"delete",t,void 0),n},has:function(e,t){const r=Reflect.has(e,t);return _t(t)&&qt.has(t)||g(e,"has",t),r},ownKeys:function(e){return g(e,"iterate",L(e)?"length":$),Reflect.ownKeys(e)}},ye={get:ve,set:(e,t)=>!0,deleteProperty:(e,t)=>!0},Et=e=>e,at=e=>Reflect.getPrototypeOf(e);function J(e,t,r=!1,n=!1){const i=d(e=e.__v_raw),s=d(t);r||(t!==s&&g(i,"get",t),g(i,"get",s));const{has:o}=at(i),a=n?Et:r?Rt:kt;return o.call(i,t)?a(e.get(t)):o.call(i,s)?a(e.get(s)):void(e!==i&&e.get(t))}function Q(e,t=!1){const r=this.__v_raw,n=d(r),i=d(e);return t||(e!==i&&g(n,"has",e),g(n,"has",i)),e===i?r.has(e):r.has(e)||r.has(i)}function X(e,t=!1){return e=e.__v_raw,!t&&g(d(e),"iterate",$),Reflect.get(e,"size",e)}function $t(e){e=d(e);const t=d(this);return at(t).has.call(t,e)||(t.add(e),P(t,"add",e,e)),this}function xt(e,t){t=d(t);const r=d(this),{has:n,get:i}=at(r);let s=n.call(r,e);s||(e=d(e),s=n.call(r,e));const o=i.call(r,e);return r.set(e,t),s?Dt(t,o)&&P(r,"set",e,t):P(r,"add",e,t),this}function Bt(e){const t=d(this),{has:r,get:n}=at(t);let i=r.call(t,e);i||(e=d(e),i=r.call(t,e)),n&&n.call(t,e);const s=t.delete(e);return i&&P(t,"delete",e,void 0),s}function Tt(){const e=d(this),t=e.size!==0,r=e.clear();return t&&P(e,"clear",void 0,void 0),r}function Y(e,t){return function(r,n){const i=this,s=i.__v_raw,o=d(s),a=t?Et:e?Rt:kt;return!e&&g(o,"iterate",$),s.forEach((h,l)=>r.call(n,a(h),a(l),i))}}function Z(e,t,r){return function(...n){const i=this.__v_raw,s=d(i),o=et(s),a=e==="entries"||e===Symbol.iterator&&o,h=e==="keys"&&o,l=i[e](...n),u=r?Et:t?Rt:kt;return!t&&g(s,"iterate",h?dt:$),{next(){const{value:p,done:ct}=l.next();return ct?{value:p,done:ct}:{value:a?[u(p[0]),u(p[1])]:u(p),done:ct}},[Symbol.iterator](){return this}}}}function R(e){return function(...t){return e!=="delete"&&this}}const[ge,_e,be,Ee]=function(){const e={get(i){return J(this,i)},get size(){return X(this)},has:Q,add:$t,set:xt,delete:Bt,clear:Tt,forEach:Y(!1,!1)},t={get(i){return J(this,i,!1,!0)},get size(){return X(this)},has:Q,add:$t,set:xt,delete:Bt,clear:Tt,forEach:Y(!1,!0)},r={get(i){return J(this,i,!0)},get size(){return X(this,!0)},has(i){return Q.call(this,i,!0)},add:R("add"),set:R("set"),delete:R("delete"),clear:R("clear"),forEach:Y(!0,!1)},n={get(i){return J(this,i,!0,!0)},get size(){return X(this,!0)},has(i){return Q.call(this,i,!0)},add:R("add"),set:R("set"),delete:R("delete"),clear:R("clear"),forEach:Y(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(i=>{e[i]=Z(i,!1,!1),r[i]=Z(i,!0,!1),t[i]=Z(i,!1,!0),n[i]=Z(i,!0,!0)}),[e,r,t,n]}();function Jt(e,t){const r=t?e?Ee:be:e?_e:ge;return(n,i,s)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?n:Reflect.get(it(r,i)&&i in n?r:n,i,s)}const Se={get:Jt(!1,!1)},ke={get:Jt(!0,!1)},Qt=new WeakMap,Re=new WeakMap,Xt=new WeakMap,Ae=new WeakMap;function St(e){return pt(e)?e:Yt(e,!1,me,Se,Qt)}function H(e){return Yt(e,!0,ye,ke,Xt)}function Yt(e,t,r,n,i){if(!ot(e)||e.__v_raw&&(!t||!e.__v_isReactive))return e;const s=i.get(e);if(s)return s;const o=(a=e).__v_skip||!Object.isExtensible(a)?0:function(l){switch(l){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(he(a));var a;if(o===0)return e;const h=new Proxy(e,o===2?n:r);return i.set(e,h),h}function pt(e){return!(!e||!e.__v_isReadonly)}function d(e){const t=e&&e.__v_raw;return t?d(t):e}const kt=e=>ot(e)?St(e):e,Rt=e=>ot(e)?H(e):e;function z(e){return!(!e||e.__v_isRef!==!0)}const Oe=e=>`[@rallie/core] you are trying to remove a listener of the broadcast event ${e}, but ${e} hasn't been registed as a broadcast event`,Le=e=>`[@rallie/core] you are trying to remove a listener of the broadcast event ${e}, but the listener hasn't been registed`,Pe=e=>`[@rallie/core] one of the callbacks of the broadcast event ${e} throws an uncaught error`,Me=e=>`[@rallie/core] you are trying to remove a listener of the unicast event ${e}, but ${e} hasn't been registed as a unicast event`,We=e=>`[@rallie/core] you are trying to register a unicast event ${e}, but it has been registered before`,$e=e=>`[@rallie/core] you have emitted ${e} unicast, but there is no listener of this event`,xe=e=>`[@rallie/core] ${e} is existing, you are not allowed to create it again`,Be=(e,t)=>`[@rallie/core] can not find any assets of the app ${e} on the bus ${t}`,Te=e=>`[@rallie/core] you are trying to activate app ${e}, but it was not created`,je=e=>`[@rallie/core] state ${e} is private, you are not allowed to set it`,Ne=e=>`[@rallie/core] please describe your action when you modify the state ${e}`,Zt=e=>`[@rallie/core] it's not allowed to set or watch state ${e} before it is initialized`,Ie=e=>`[@rallie/core] duplicated initialized state ${e}`,ze=e=>`[@rallie/core] it's not allowed to initialized state ${e} to a primitive value`,Ue=e=>`[@rallie/core] the bus named ${e} has been defined before, please rename your bus`,Ce=(e,t)=>`[@rallie/core] There is a circular dependency when activating the app ${e}, and the circular path is ${t.join("->")}`,De=()=>"[@rallie/core] next() called multiple times in the middleware",Ve=()=>"[@rallie/core] the middleware must be a function",Ge=(e,t)=>`[@rallie/core] the event ${e} is not in the events pool that you specified when calling on${t?"Unicast":"Broadcast"}`,jt=e=>(t,r)=>{let n=-1;const i=s=>{if(s<=n)return Promise.reject(new Error(De()));n=s;let o=e[s];if(s===e.length&&(o=r),!o)return Promise.resolve();try{return Promise.resolve(o(t,i.bind(null,s+1)))}catch(a){return Promise.reject(a)}};return i(0)};var E,M,rt,U,C,v,_,wt,te;class Fe{constructor(){E.set(this,{}),M.set(this,{})}addBroadcastEventListener(t,r){c(this,E,"f")[t]=c(this,E,"f")[t]||new Set,c(this,E,"f")[t].add(r)}addUnicastEventListener(t,r){if(c(this,M,"f")[t])throw new Error(We(t));c(this,M,"f")[t]=r}removeBroadcastEventListener(t,r){const n=c(this,E,"f")[t];if(!n){const i=Oe(t);throw new Error(i)}if(!n.has(r)){const i=Le(t);throw new Error(i)}n.delete(r)}removeUnicastEventListener(t){if(!c(this,M,"f")[t]){const r=Me(t);throw new Error(r)}delete c(this,M,"f")[t]}emitBroadcast(t,...r){c(this,E,"f")[t]=c(this,E,"f")[t]||new Set,c(this,E,"f")[t].forEach(n=>{try{n(...r)}catch(i){console.error(Pe(t)),console.error(i)}})}emitUnicast(t,...r){const n=c(this,M,"f")[t];if(n)return n(...r);throw new Error($e(t))}}E=new WeakMap,M=new WeakMap;class Ke{constructor(t,r){rt.set(this,void 0),U.set(this,void 0),W(this,rt,t,"f"),W(this,U,r,"f"),c(this,U,"f")[t].watchers.add(this)}do(t){return this.handler=t,()=>this.unwatch()}unwatch(){this==null||this.stopEffect(),this.handler=null;const t=c(this,U,"f")[c(this,rt,"f")].watchers;t.has(this)&&t.delete(this)}}rt=new WeakMap,U=new WeakMap;class qe{constructor(t,r){C.add(this),v.set(this,void 0),_.set(this,void 0),W(this,v,t,"f"),W(this,_,r,"f")}onBroadcast(t){return Object.entries(t).forEach(([r,n])=>{c(this,v,"f").addBroadcastEventListener(r,n)}),r=>{c(this,C,"m",wt).call(this,t,!1,r)}}onUnicast(t){return Object.entries(t).forEach(([r,n])=>{try{c(this,v,"f").addUnicastEventListener(r,n)}catch(i){console.error(i)}}),r=>{c(this,C,"m",wt).call(this,t,!0,r)}}createBroadcaster(t){return new Proxy({},{get:(r,n)=>(...i)=>c(this,v,"f").emitBroadcast(n,...i,t==null?void 0:t(n)),set:()=>!1})}createUnicaster(t){return new Proxy({},{get:(r,n)=>(...i)=>c(this,v,"f").emitUnicast(n,...i,t==null?void 0:t(n)),set:()=>!1})}existState(t){return!!c(this,_,"f")[t]}initState(t,r,n=!1){if(this.existState(t))throw new Error(Ie(t));if(["string","number","boolean","undefined"].includes(typeof r))throw new Error(ze(t));return c(this,_,"f")[t]={state:St(r),owner:n?this:null,watchers:new Set},c(this,v,"f").emitBroadcast("$state-initialized",t),this.getState(t)}getState(t,r){if(this.existState(t)){const n=H(c(this,_,"f")[t].state);return r?r(n):n}return null}setState(t,r,n){return S(this,void 0,void 0,function*(){const i=c(this,C,"m",te).call(this,t);if(!r)throw new Error(Ne(t));{const s=n(i);yield Promise.resolve(s)}})}watchState(t,r){if(!this.existState(t)){const a=Zt(t);throw new Error(a)}let n=!1;const i=H(c(this,_,"f")[t].state),s=new Ke(t,c(this,_,"f")),o=function(a,h){a.effect&&(a=a.effect.fn);const l=new de(a);h&&(ae(l,h),h.scope&&Vt(l,h.scope)),h&&h.lazy||l.run();const u=l.run.bind(l);return u.effect=l,u}(()=>r(i),{lazy:!0,scheduler:()=>{n||(n=!0,Promise.resolve().then(()=>{var a;const h=d(r(i));(a=s.handler)===null||a===void 0||a.call(s,h,s.oldWatchingStates),s.oldWatchingStates=d(h),n=!1}))}});return s.oldWatchingStates=o(),s.stopEffect=()=>o.effect.stop(),s}}v=new WeakMap,_=new WeakMap,C=new WeakSet,wt=function(e,t,r){let n=t?c(this,v,"f").removeUnicastEventListener:c(this,v,"f").removeBroadcastEventListener;n=n.bind(c(this,v,"f")),r?e[r]?(n(r,e[r]),delete e[r]):console.warn(Ge(r,t)):Object.entries(e).forEach(([i,s])=>{n(i,s)})},te=function(e){if(!this.existState(e)){const r=Zt(e);throw new Error(r)}const t=c(this,_,"f")[e].owner;if(t!==this&&t!==null){const r=je(e);throw new Error(r)}return c(this,_,"f")[e].state};class He{constructor(t){this.name=t,this.activated=null,this.dependencies=[],this.relatedApps=[],this.name=t,this.isRallieCoreApp=!0}relateTo(t){return this.relatedApps=Array.from(new Set([...this.relatedApps,...t])),this}relyOn(t){return this.relateTo(t),this.dependencies=Array.from(new Set([...this.dependencies,...t])),this}onActivate(t){return this.doActivate=t,this}}var k,st,vt,mt,m,D,V,G,Nt,ee,re,yt,It,zt,tt={loadScript:e=>S(void 0,void 0,void 0,function*(){return new Promise(t=>{let r=null;e instanceof HTMLScriptElement?r=e:(r=document.createElement("script"),Object.entries(typeof e!="string"?e:{type:"text/javascript",src:e}).forEach(([i,s])=>{r.setAttribute(i,s)})),r.src&&(r.onload=r.onerror=()=>{t()}),document.body.appendChild(r),r.src||t()})}),loadLink:e=>{let t=null;if(e instanceof HTMLLinkElement)t=e;else{const r=typeof e!="string"?e:{rel:"stylesheet",type:"text/css",href:e};t=document.createElement("link"),Object.entries(r).forEach(([n,i])=>{t.setAttribute(n,i)})}document.head.appendChild(t)}};class Je{constructor(t){k.add(this),st.set(this,void 0),vt.set(this,new Fe),mt.set(this,{}),m.set(this,{}),D.set(this,{}),this.conf=H({assets:{}}),V.set(this,[]),G.set(this,void 0),W(this,st,t,"f"),W(this,G,jt(c(this,V,"f")),"f")}createSocket(){return new qe(c(this,vt,"f"),c(this,mt,"f"))}existApp(t){return!!c(this,m,"f")[t]}createApp(t){if(this.existApp(t))throw new Error(xe(t));const r=new He(t);return c(this,m,"f")[t]=r,r}loadApp(t){return S(this,void 0,void 0,function*(){c(this,m,"f")[t]||(c(this,D,"f")[t]||(c(this,D,"f")[t]=new Promise((r,n)=>{const i=c(this,k,"m",ee).call(this,t);c(this,G,"f").call(this,i,c(this,k,"m",re).bind(this)).then(()=>{t.startsWith("lib:")&&!c(this,m,"f")[t]&&(c(this,m,"f")[t]=!0),c(this,m,"f")[t]||n(new Error(Te(t))),r()}).catch(s=>{n(s)})})),yield c(this,D,"f")[t])})}activateApp(t){return S(this,void 0,void 0,function*(){yield c(this,k,"m",yt).call(this,t,[])})}config(t){return this.conf=Object.assign(Object.assign(Object.assign({},this.conf),t),{assets:Object.assign(Object.assign({},this.conf.assets),(t==null?void 0:t.assets)||{})}),this}use(t){if(typeof t!="function")throw new Error(Ve());return c(this,V,"f").push(t),W(this,G,jt(c(this,V,"f")),"f"),this}}st=new WeakMap,vt=new WeakMap,mt=new WeakMap,m=new WeakMap,D=new WeakMap,V=new WeakMap,G=new WeakMap,k=new WeakSet,Nt=function(e){return c(this,m,"f")[e]&&typeof c(this,m,"f")[e]!="boolean"},ee=function(e){return{name:e,loadScript:tt.loadScript,loadLink:tt.loadLink}},re=function(e){return S(this,void 0,void 0,function*(){const{name:t,loadScript:r=tt.loadScript,loadLink:n=tt.loadLink}=e,{assets:i}=this.conf;if(!i[t])throw new Error(Be(t,c(this,st,"f")));if(i[t].css&&i[t].css.forEach(s=>{n(s)}),i[t].js)for(const s of i[t].js)yield r(s)})},yt=function(e,t){return S(this,void 0,void 0,function*(){if(yield this.loadApp(e),c(this,k,"m",Nt).call(this,e)){const r=c(this,m,"f")[e];if(yield c(this,k,"m",zt).call(this,r),t.includes(e)){const n=t.indexOf(e),i=[...t.slice(n),e];throw new Error(Ce(e,i))}if(t.push(e),!r.activated){const n=()=>S(this,void 0,void 0,function*(){yield c(this,k,"m",It).call(this,r,t),r.doActivate&&(yield Promise.resolve(r.doActivate()))});r.activated=n()}yield r.activated,t.pop()}})},It=function(e,t){return S(this,void 0,void 0,function*(){if(e.dependencies.length!==0)for(const r of e.dependencies)yield c(this,k,"m",yt).call(this,r,t)})},zt=function(e){return S(this,void 0,void 0,function*(){yield Promise.all(e.relatedApps.map(t=>this.loadApp(t)))})};const Qe={},lt="DEFAULT_BUS",gt=(e=lt)=>{let t=null,r=!1;const n=((i=lt)=>window.RALLIE_BUS_STORE&&window.RALLIE_BUS_STORE[i])(e);return n?(t=n,r=!1):(t=((i=lt)=>{if(window.RALLIE_BUS_STORE===void 0&&Reflect.defineProperty(window,"RALLIE_BUS_STORE",{value:Qe,writable:!1}),window.RALLIE_BUS_STORE[i])throw new Error(Ue(i));{const s=new Je(i);return Reflect.defineProperty(window.RALLIE_BUS_STORE,i,{value:s,writable:!1}),s}})(e),r=!0),[t,r]},y={privateBus:e=>`${e}.bus`,stateNamespace:e=>`${e}.state`,isGlobalBusAccessible:"isGlobalBusAccessible",exportMethodName:"__RallieInnerExport__"},ht=e=>`[rallie] ${e}`,nt={stateNotInitialized:e=>ht(` the block ${e}'s state is not initialized, please check:
1. whether the block ${e} is loaded.
2. whether the block ${e} has initialized the state`),duplicatedBlockName:e=>ht(`the block ${e} is already registered before, please rename your block`),stateIsReadonly:e=>ht(`the state of ${e} is readonly`)};var w,A,F,j,K,N,q;class Ut{constructor(t,r,n){w.set(this,void 0),this.name=t,T(this,w,n,"f"),this.events=f(this,w,"f").createBroadcaster(()=>r),this.methods=f(this,w,"f").createUnicaster(()=>r),Reflect.defineProperty(this,"state",{get:()=>f(this,w,"f").getState(y.stateNamespace(this.name)),set:()=>{throw new Error(nt.stateIsReadonly(this.name))}})}setState(t,r){if(f(this,w,"f").existState(y.stateNamespace(this.name)))return f(this,w,"f").setState(y.stateNamespace(this.name),t,r);throw new Error(nt.stateNotInitialized(this.name))}watchState(t){if(f(this,w,"f").existState(y.stateNamespace(this.name)))return f(this,w,"f").watchState(y.stateNamespace(this.name),t);throw new Error(nt.stateNotInitialized(this.name))}listenEvents(t){return f(this,w,"f").onBroadcast(t)}}w=new WeakMap;class Xe extends Ut{constructor(t,r,n,i){const[s]=gt(y.privateBus(t)),o=s.createSocket();super(t,t,o),A.set(this,void 0),F.set(this,void 0),j.set(this,void 0),K.set(this,void 0),N.set(this,void 0),q.set(this,{}),T(this,K,o,"f"),T(this,A,r,"f"),T(this,F,n,"f"),T(this,N,r.createApp(t),"f"),T(this,j,i,"f")}initState(t,r){return f(this,K,"f").initState(y.stateNamespace(this.name),t,r),this}addMethods(t){return f(this,K,"f").onUnicast(t)}relyOn(t){return f(this,N,"f").relyOn(t),this}relateTo(t){return f(this,N,"f").relateTo(t),this}onActivate(t){return f(this,N,"f").onActivate(t),this}connect(t){if(!f(this,q,"f")[t]){const[r]=gt(y.privateBus(t)),n=r.createSocket();f(this,q,"f")[t]=new Ut(t,this.name,n)}return f(this,q,"f")[t]}load(t){return f(this,A,"f").loadApp(t)}activate(t){return f(this,A,"f").activateApp(t)}run(t){var r;return oe(this,void 0,void 0,function*(){const n=f(this,j,"f")||((r=f(this,F,"f").getState(y.isGlobalBusAccessible))===null||r===void 0?void 0:r.value),i=a=>{f(this,j,"f")&&f(this,F,"f").setState(y.isGlobalBusAccessible,a?"unfreeze the enviroment":"freeze the enviroment",h=>{h.value=a})},s={isEntry:f(this,j,"f"),use:a=>{n&&f(this,A,"f").use(a)},config:a=>{n&&f(this,A,"f").config(a)},freeze:()=>{i(!1)},unfreeze:()=>{i(!0)}},o=t(new Proxy(s,{get:(a,h,l)=>h==="conf"?JSON.parse(JSON.stringify(f(this,A,"f").conf)):Reflect.get(a,h,l),set:()=>!1}));yield Promise.resolve(o)})}}function Ye(e){const[t,r]=gt();if(t.existApp(e))throw new Error(nt.duplicatedBlockName(e));const n=t.createSocket();return r&&n.initState(y.isGlobalBusAccessible,{value:!0},!0),new Xe(e,t,n,r)}A=new WeakMap,F=new WeakMap,j=new WeakMap,K=new WeakMap,N=new WeakMap,q=new WeakMap;const ne=Ye("demo-plugin").initState({count:0}).relyOn(["core"]).onActivate(async()=>{const e=ne.connect("core");if(e.setState("注册首页",t=>{t.slot.home=()=>B(()=>import("./Home-73448ee2.js"),[],import.meta.url)}),e.setState("注册应用",t=>{t.applications.push({name:"测试应用",locale:"demo-plugin:menu.root",path:"demo",children:[{index:!0,loader:()=>B(()=>import("./App-66461800.js"),["./App-66461800.js","./App-19634022.css"],import.meta.url)},{name:"菜单1",locale:"demo-plugin:menu.firstChild",path:"level-1",loader:()=>B(()=>import("./App-66461800.js"),["./App-66461800.js","./App-19634022.css"],import.meta.url)}]})}),await e.methods.addI18nResources({"zh-CN":()=>B(()=>import("./zh-CN-7d02853d.js"),[],import.meta.url),"en-US":()=>B(()=>import("./en-US-e609e853.js"),[],import.meta.url)}),!e.state.root){const t=document.createElement("div");document.body.appendChild(t),e.setState("挂载root",r=>{r.root=t})}});ne.run(e=>{e.isEntry&&B(()=>import("./dev-a232110a.js"),[],import.meta.url).then(t=>{t.runInNonEntryMode(e)})});export{ne as d};
