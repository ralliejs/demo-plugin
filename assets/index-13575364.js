(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const oe="modulepreload",ae=function(t,e){return new URL(t,e).href},Ot={},x=function(e,i,r){if(!i||i.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(i.map(s=>{if(s=ae(s,r),s in Ot)return;Ot[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=n.length-1;u>=0;u--){const p=n[u];if(p.href===s&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":oe,o||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),o)return new Promise((u,p)=>{l.addEventListener("load",u),l.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};function ce(t,e,i,r){return new(i||(i=Promise))(function(n,s){function o(l){try{h(r.next(l))}catch(u){s(u)}}function a(l){try{h(r.throw(l))}catch(u){s(u)}}function h(l){var u;l.done?n(l.value):(u=l.value,u instanceof i?u:new i(function(p){p(u)})).then(o,a)}h((r=r.apply(t,e||[])).next())})}function f(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function M(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}function S(t,e,i,r){return new(i||(i=Promise))(function(n,s){function o(l){try{h(r.next(l))}catch(u){s(u)}}function a(l){try{h(r.throw(l))}catch(u){s(u)}}function h(l){var u;l.done?n(l.value):(u=l.value,u instanceof i?u:new i(function(p){p(u)})).then(o,a)}h((r=r.apply(t,e||[])).next())})}function c(t,e,i,r){if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?r:i==="a"?r.call(t):r?r.value:e.get(t)}function $(t,e,i,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,i):n?n.value=i:e.set(t,i),i}const le=Object.assign,he=Object.prototype.hasOwnProperty,st=(t,e)=>he.call(t,e),L=Array.isArray,et=t=>Dt(t)==="[object Map]",bt=t=>typeof t=="symbol",at=t=>t!==null&&typeof t=="object",ue=Object.prototype.toString,Dt=t=>ue.call(t),fe=t=>Dt(t).slice(8,-1),Et=t=>typeof t=="string"&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Gt=(t,e)=>!Object.is(t,e),de=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let pe;function Ft(t,e=pe){e&&e.active&&e.effects.push(t)}const Ht=t=>{const e=new Set(t);return e.w=0,e.n=0,e},Kt=t=>(t.w&O)>0,qt=t=>(t.n&O)>0,ft=new WeakMap;let I=0,O=1;const dt=30;let b;const j=Symbol(""),pt=Symbol("");class we{constructor(e,i=null,r){this.fn=e,this.scheduler=i,this.active=!0,this.deps=[],this.parent=void 0,Ft(this,r)}run(){if(!this.active)return this.fn();let e=b,i=B;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=b,b=this,B=!0,O=1<<++I,I<=dt?(({deps:r})=>{if(r.length)for(let n=0;n<r.length;n++)r[n].w|=O})(this):Lt(this),this.fn()}finally{I<=dt&&(r=>{const{deps:n}=r;if(n.length){let s=0;for(let o=0;o<n.length;o++){const a=n[o];Kt(a)&&!qt(a)?a.delete(r):n[s++]=a,a.w&=~O,a.n&=~O}n.length=s}})(this),O=1<<--I,b=this.parent,B=i,this.parent=void 0,this.deferStop&&this.stop()}}stop(){b===this?this.deferStop=!0:this.active&&(Lt(this),this.onStop&&this.onStop(),this.active=!1)}}function Lt(t){const{deps:e}=t;if(e.length){for(let i=0;i<e.length;i++)e[i].delete(t);e.length=0}}let B=!0;const Pt=[];function g(t,e,i){if(B&&b){let r=ft.get(t);r||ft.set(t,r=new Map);let n=r.get(i);n||r.set(i,n=Ht()),function(s,o){let a=!1;I<=dt?qt(s)||(s.n|=O,a=!Kt(s)):a=!s.has(b),a&&(s.add(b),b.deps.push(s))}(n)}}function P(t,e,i,r,n,s){const o=ft.get(t);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(i==="length"&&L(t)){const h=de(r);o.forEach((l,u)=>{(u==="length"||u>=h)&&a.push(l)})}else switch(i!==void 0&&a.push(o.get(i)),e){case"add":L(t)?Et(i)&&a.push(o.get("length")):(a.push(o.get(j)),et(t)&&a.push(o.get(pt)));break;case"delete":L(t)||(a.push(o.get(j)),et(t)&&a.push(o.get(pt)));break;case"set":et(t)&&a.push(o.get(j))}if(a.length===1)a[0]&&xt(a[0]);else{const h=[];for(const l of a)l&&h.push(...l);xt(Ht(h))}}function xt(t,e){const i=L(t)?t:[...t];for(const r of i)r.computed&&Wt(r);for(const r of i)r.computed||Wt(r)}function Wt(t,e){(t!==b||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const ve=function(t,e){const i=Object.create(null),r=t.split(",");for(let n=0;n<r.length;n++)i[r[n]]=!0;return e?n=>!!i[n.toLowerCase()]:n=>!!i[n]}("__proto__,__v_isRef,__isVue"),Jt=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(bt)),me=Qt(),ye=Qt(!0),$t=function(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...i){const r=d(this);for(let s=0,o=this.length;s<o;s++)g(r,"get",s+"");const n=r[e](...i);return n===-1||n===!1?r[e](...i.map(d)):n}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...i){Pt.push(B),B=!1;const r=d(this)[e].apply(this,i);return function(){const n=Pt.pop();B=n===void 0||n}(),r}}),t}();function Qt(t=!1,e=!1){return function(i,r,n){if(r==="__v_isReactive")return!t;if(r==="__v_isReadonly")return t;if(r==="__v_isShallow")return e;if(r==="__v_raw"&&n===(t?e?Le:Zt:e?Oe:Yt).get(i))return i;const s=L(i);if(!t&&s&&st($t,r))return Reflect.get($t,r,n);const o=Reflect.get(i,r,n);return(bt(r)?Jt.has(r):ve(r))?o:(t||g(i,"get",r),e?o:z(o)?s&&Et(r)?o:o.value:at(o)?t?q(o):kt(o):o)}}const ge={get:me,set:function(t=!1){return function(e,i,r,n){let s=e[i];if(wt(s)&&z(s)&&!z(r))return!1;if(!t&&(function(h){return!(!h||!h.__v_isShallow)}(r)||wt(r)||(s=d(s),r=d(r)),!L(e)&&z(s)&&!z(r)))return s.value=r,!0;const o=L(e)&&Et(i)?Number(i)<e.length:st(e,i),a=Reflect.set(e,i,r,n);return e===d(n)&&(o?Gt(r,s)&&P(e,"set",i,r):P(e,"add",i,r)),a}}(),deleteProperty:function(t,e){const i=st(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&i&&P(t,"delete",e,void 0),r},has:function(t,e){const i=Reflect.has(t,e);return bt(e)&&Jt.has(e)||g(t,"has",e),i},ownKeys:function(t){return g(t,"iterate",L(t)?"length":j),Reflect.ownKeys(t)}},_e={get:ye,set:(t,e)=>!0,deleteProperty:(t,e)=>!0},St=t=>t,ct=t=>Reflect.getPrototypeOf(t);function J(t,e,i=!1,r=!1){const n=d(t=t.__v_raw),s=d(e);i||(e!==s&&g(n,"get",e),g(n,"get",s));const{has:o}=ct(n),a=r?St:i?Rt:At;return o.call(n,e)?a(t.get(e)):o.call(n,s)?a(t.get(s)):void(t!==n&&t.get(e))}function Q(t,e=!1){const i=this.__v_raw,r=d(i),n=d(t);return e||(t!==n&&g(r,"has",t),g(r,"has",n)),t===n?i.has(t):i.has(t)||i.has(n)}function X(t,e=!1){return t=t.__v_raw,!e&&g(d(t),"iterate",j),Reflect.get(t,"size",t)}function jt(t){t=d(t);const e=d(this);return ct(e).has.call(e,t)||(e.add(t),P(e,"add",t,t)),this}function Bt(t,e){e=d(e);const i=d(this),{has:r,get:n}=ct(i);let s=r.call(i,t);s||(t=d(t),s=r.call(i,t));const o=n.call(i,t);return i.set(t,e),s?Gt(e,o)&&P(i,"set",t,e):P(i,"add",t,e),this}function Mt(t){const e=d(this),{has:i,get:r}=ct(e);let n=i.call(e,t);n||(t=d(t),n=i.call(e,t)),r&&r.call(e,t);const s=e.delete(t);return n&&P(e,"delete",t,void 0),s}function Tt(){const t=d(this),e=t.size!==0,i=t.clear();return e&&P(t,"clear",void 0,void 0),i}function Y(t,e){return function(i,r){const n=this,s=n.__v_raw,o=d(s),a=e?St:t?Rt:At;return!t&&g(o,"iterate",j),s.forEach((h,l)=>i.call(r,a(h),a(l),n))}}function Z(t,e,i){return function(...r){const n=this.__v_raw,s=d(n),o=et(s),a=t==="entries"||t===Symbol.iterator&&o,h=t==="keys"&&o,l=n[t](...r),u=i?St:e?Rt:At;return!e&&g(s,"iterate",h?pt:j),{next(){const{value:p,done:lt}=l.next();return lt?{value:p,done:lt}:{value:a?[u(p[0]),u(p[1])]:u(p),done:lt}},[Symbol.iterator](){return this}}}}function A(t){return function(...e){return t!=="delete"&&this}}const[be,Ee,Se,ke]=function(){const t={get(n){return J(this,n)},get size(){return X(this)},has:Q,add:jt,set:Bt,delete:Mt,clear:Tt,forEach:Y(!1,!1)},e={get(n){return J(this,n,!1,!0)},get size(){return X(this)},has:Q,add:jt,set:Bt,delete:Mt,clear:Tt,forEach:Y(!1,!0)},i={get(n){return J(this,n,!0)},get size(){return X(this,!0)},has(n){return Q.call(this,n,!0)},add:A("add"),set:A("set"),delete:A("delete"),clear:A("clear"),forEach:Y(!0,!1)},r={get(n){return J(this,n,!0,!0)},get size(){return X(this,!0)},has(n){return Q.call(this,n,!0)},add:A("add"),set:A("set"),delete:A("delete"),clear:A("clear"),forEach:Y(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(n=>{t[n]=Z(n,!1,!1),i[n]=Z(n,!0,!1),e[n]=Z(n,!1,!0),r[n]=Z(n,!0,!0)}),[t,i,e,r]}();function Xt(t,e){const i=e?t?ke:Se:t?Ee:be;return(r,n,s)=>n==="__v_isReactive"?!t:n==="__v_isReadonly"?t:n==="__v_raw"?r:Reflect.get(st(i,n)&&n in r?i:r,n,s)}const Ae={get:Xt(!1,!1)},Re={get:Xt(!0,!1)},Yt=new WeakMap,Oe=new WeakMap,Zt=new WeakMap,Le=new WeakMap;function kt(t){return wt(t)?t:te(t,!1,ge,Ae,Yt)}function q(t){return te(t,!0,_e,Re,Zt)}function te(t,e,i,r,n){if(!at(t)||t.__v_raw&&(!e||!t.__v_isReactive))return t;const s=n.get(t);if(s)return s;const o=(a=t).__v_skip||!Object.isExtensible(a)?0:function(l){switch(l){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(fe(a));var a;if(o===0)return t;const h=new Proxy(t,o===2?r:i);return n.set(t,h),h}function wt(t){return!(!t||!t.__v_isReadonly)}function d(t){const e=t&&t.__v_raw;return e?d(e):t}const At=t=>at(t)?kt(t):t,Rt=t=>at(t)?q(t):t;function z(t){return!(!t||t.__v_isRef!==!0)}const Pe=t=>`[@rallie/core] you are trying to remove a listener of the broadcast event ${t}, but ${t} hasn't been registed as a broadcast event`,xe=t=>`[@rallie/core] you are trying to remove a listener of the broadcast event ${t}, but the listener hasn't been registed`,We=t=>`[@rallie/core] one of the callbacks of the broadcast event ${t} throws an uncaught error`,$e=t=>`[@rallie/core] you are trying to remove a listener of the unicast event ${t}, but ${t} hasn't been registed as a unicast event`,je=t=>`[@rallie/core] you are trying to register a unicast event ${t}, but it has been registered before`,Be=t=>`[@rallie/core] you have emitted ${t} unicast, but there is no listener of this event`,Me=t=>`[@rallie/core] ${t} is existing, you are not allowed to create it again`,Te=(t,e)=>`[@rallie/core] can not find any assets of the app ${t} on the bus ${e}`,Ne=t=>`[@rallie/core] you are trying to activate app ${t}, but it was not created`,Ie=t=>`[@rallie/core] state ${t} is private, you are not allowed to set it`,ze=t=>`[@rallie/core] please describe your action when you modify the state ${t}`,ee=t=>`[@rallie/core] it's not allowed to set or watch state ${t} before it is initialized`,Ue=t=>`[@rallie/core] duplicated initialized state ${t}`,Ce=t=>`[@rallie/core] it's not allowed to initialized state ${t} to a primitive value`,Ve=t=>`[@rallie/core] the bus named ${t} has been defined before, please rename your bus`,De=(t,e)=>`[@rallie/core] There is a circular dependency when activating the app ${t}, and the circular path is ${e.join("->")}`,Ge=()=>"[@rallie/core] next() called multiple times in the middleware",Fe=()=>"[@rallie/core] the middleware must be a function",He=(t,e)=>`[@rallie/core] the event ${t} is not in the events pool that you specified when calling on${e?"Unicast":"Broadcast"}`,Nt=t=>(e,i)=>{let r=-1;const n=s=>{if(s<=r)return Promise.reject(new Error(Ge()));r=s;let o=t[s];if(s===t.length&&(o=i),!o)return Promise.resolve();try{return Promise.resolve(o(e,n.bind(null,s+1)))}catch(a){return Promise.reject(a)}};return n(0)};var E,W,it,U,C,v,_,vt,ie;class Ke{constructor(){E.set(this,{}),W.set(this,{})}addBroadcastEventListener(e,i){c(this,E,"f")[e]=c(this,E,"f")[e]||new Set,c(this,E,"f")[e].add(i)}addUnicastEventListener(e,i){if(c(this,W,"f")[e])throw new Error(je(e));c(this,W,"f")[e]=i}removeBroadcastEventListener(e,i){const r=c(this,E,"f")[e];if(!r){const n=Pe(e);throw new Error(n)}if(!r.has(i)){const n=xe(e);throw new Error(n)}r.delete(i)}removeUnicastEventListener(e){if(!c(this,W,"f")[e]){const i=$e(e);throw new Error(i)}delete c(this,W,"f")[e]}emitBroadcast(e,...i){c(this,E,"f")[e]=c(this,E,"f")[e]||new Set,c(this,E,"f")[e].forEach(r=>{try{r(...i)}catch(n){console.error(We(e)),console.error(n)}})}emitUnicast(e,...i){const r=c(this,W,"f")[e];if(r)return r(...i);throw new Error(Be(e))}}E=new WeakMap,W=new WeakMap;class qe{constructor(e,i){it.set(this,void 0),U.set(this,void 0),$(this,it,e,"f"),$(this,U,i,"f"),c(this,U,"f")[e].watchers.add(this)}do(e){return this.handler=e,()=>this.unwatch()}unwatch(){this==null||this.stopEffect(),this.handler=null;const e=c(this,U,"f")[c(this,it,"f")].watchers;e.has(this)&&e.delete(this)}}it=new WeakMap,U=new WeakMap;class Je{constructor(e,i){C.add(this),v.set(this,void 0),_.set(this,void 0),$(this,v,e,"f"),$(this,_,i,"f")}onBroadcast(e){return Object.entries(e).forEach(([i,r])=>{c(this,v,"f").addBroadcastEventListener(i,r)}),i=>{c(this,C,"m",vt).call(this,e,!1,i)}}onUnicast(e){return Object.entries(e).forEach(([i,r])=>{try{c(this,v,"f").addUnicastEventListener(i,r)}catch(n){console.error(n)}}),i=>{c(this,C,"m",vt).call(this,e,!0,i)}}createBroadcaster(e){return new Proxy({},{get:(i,r)=>(...n)=>(e==null||e(r),c(this,v,"f").emitBroadcast(r,...n)),set:()=>!1})}createUnicaster(e){return new Proxy({},{get:(i,r)=>(...n)=>(e==null||e(r),c(this,v,"f").emitUnicast(r,...n)),set:()=>!1})}existState(e){return!!c(this,_,"f")[e]}initState(e,i,r=!1){if(this.existState(e))throw new Error(Ue(e));if(["string","number","boolean","undefined"].includes(typeof i))throw new Error(Ce(e));return c(this,_,"f")[e]={state:kt(i),owner:r?this:null,watchers:new Set},c(this,v,"f").emitBroadcast("$state-initialized",e),this.getState(e)}getState(e,i){if(this.existState(e)){const r=q(c(this,_,"f")[e].state);return i?i(r):r}return null}setState(e,i,r){return S(this,void 0,void 0,function*(){const n=c(this,C,"m",ie).call(this,e);if(!i)throw new Error(ze(e));{const s=r(n);yield Promise.resolve(s)}})}watchState(e,i){if(!this.existState(e)){const a=ee(e);throw new Error(a)}let r=!1;const n=q(c(this,_,"f")[e].state),s=new qe(e,c(this,_,"f")),o=function(a,h){a.effect&&(a=a.effect.fn);const l=new we(a);h&&(le(l,h),h.scope&&Ft(l,h.scope)),h&&h.lazy||l.run();const u=l.run.bind(l);return u.effect=l,u}(()=>i(n),{lazy:!0,scheduler:()=>{r||(r=!0,Promise.resolve().then(()=>{var a;const h=d(i(n));(a=s.handler)===null||a===void 0||a.call(s,h,s.oldWatchingStates),s.oldWatchingStates=d(h),r=!1}))}});return s.oldWatchingStates=o(),s.stopEffect=()=>o.effect.stop(),s}}v=new WeakMap,_=new WeakMap,C=new WeakSet,vt=function(t,e,i){let r=e?c(this,v,"f").removeUnicastEventListener:c(this,v,"f").removeBroadcastEventListener;r=r.bind(c(this,v,"f")),i?t[i]?(r(i,t[i]),delete t[i]):console.warn(He(i,e)):Object.entries(t).forEach(([n,s])=>{r(n,s)})},ie=function(t){if(!this.existState(t)){const i=ee(t);throw new Error(i)}const e=c(this,_,"f")[t].owner;if(e!==this&&e!==null){const i=Ie(t);throw new Error(i)}return c(this,_,"f")[t].state};class Qe{constructor(e){this.name=e,this.activated=null,this.dependencies=[],this.relatedApps=[],this.name=e,this.isRallieCoreApp=!0}relateTo(e){return this.relatedApps=Array.from(new Set([...this.relatedApps,...e])),this}relyOn(e){return this.relateTo(e),this.dependencies=Array.from(new Set([...this.dependencies,...e])),this}onActivate(e){return this.doActivate=e,this}}var k,ot,mt,yt,m,V,D,G,It,re,ne,gt,zt,Ut,tt={loadScript:t=>S(void 0,void 0,void 0,function*(){return new Promise(e=>{let i=null;t instanceof HTMLScriptElement?i=t:(i=document.createElement("script"),Object.entries(typeof t!="string"?t:{type:"text/javascript",src:t}).forEach(([n,s])=>{i.setAttribute(n,s)})),i.src&&(i.onload=i.onerror=()=>{e()}),document.body.appendChild(i),i.src||e()})}),loadLink:t=>{let e=null;if(t instanceof HTMLLinkElement)e=t;else{const i=typeof t!="string"?t:{rel:"stylesheet",type:"text/css",href:t};e=document.createElement("link"),Object.entries(i).forEach(([r,n])=>{e.setAttribute(r,n)})}document.head.appendChild(e)}};class Xe{constructor(e){k.add(this),ot.set(this,void 0),mt.set(this,new Ke),yt.set(this,{}),m.set(this,{}),V.set(this,{}),this.conf=q({assets:{}}),D.set(this,[]),G.set(this,void 0),$(this,ot,e,"f"),$(this,G,Nt(c(this,D,"f")),"f")}createSocket(){return new Je(c(this,mt,"f"),c(this,yt,"f"))}existApp(e){return!!c(this,m,"f")[e]}createApp(e){if(this.existApp(e))throw new Error(Me(e));const i=new Qe(e);return c(this,m,"f")[e]=i,i}loadApp(e){return S(this,void 0,void 0,function*(){c(this,m,"f")[e]||(c(this,V,"f")[e]||(c(this,V,"f")[e]=new Promise((i,r)=>{const n=c(this,k,"m",re).call(this,e);c(this,G,"f").call(this,n,c(this,k,"m",ne).bind(this)).then(()=>{e.startsWith("lib:")&&!c(this,m,"f")[e]&&(c(this,m,"f")[e]=!0),c(this,m,"f")[e]||r(new Error(Ne(e))),i()}).catch(s=>{r(s)})})),yield c(this,V,"f")[e])})}activateApp(e){return S(this,void 0,void 0,function*(){yield c(this,k,"m",gt).call(this,e,[])})}config(e){return this.conf=Object.assign(Object.assign(Object.assign({},this.conf),e),{assets:Object.assign(Object.assign({},this.conf.assets),(e==null?void 0:e.assets)||{})}),this}use(e){if(typeof e!="function")throw new Error(Fe());return c(this,D,"f").push(e),$(this,G,Nt(c(this,D,"f")),"f"),this}}ot=new WeakMap,mt=new WeakMap,yt=new WeakMap,m=new WeakMap,V=new WeakMap,D=new WeakMap,G=new WeakMap,k=new WeakSet,It=function(t){return c(this,m,"f")[t]&&typeof c(this,m,"f")[t]!="boolean"},re=function(t){return{name:t,loadScript:tt.loadScript,loadLink:tt.loadLink}},ne=function(t){return S(this,void 0,void 0,function*(){const{name:e,loadScript:i=tt.loadScript,loadLink:r=tt.loadLink}=t,{assets:n}=this.conf;if(!n[e])throw new Error(Te(e,c(this,ot,"f")));if(n[e].css&&n[e].css.forEach(s=>{r(s)}),n[e].js)for(const s of n[e].js)yield i(s)})},gt=function(t,e){return S(this,void 0,void 0,function*(){if(yield this.loadApp(t),c(this,k,"m",It).call(this,t)){const i=c(this,m,"f")[t];if(yield c(this,k,"m",Ut).call(this,i),e.includes(t)){const r=e.indexOf(t),n=[...e.slice(r),t];throw new Error(De(t,n))}if(e.push(t),!i.activated){const r=()=>S(this,void 0,void 0,function*(){yield c(this,k,"m",zt).call(this,i,e),i.doActivate&&(yield Promise.resolve(i.doActivate()))});i.activated=r()}yield i.activated,e.pop()}})},zt=function(t,e){return S(this,void 0,void 0,function*(){if(t.dependencies.length!==0)for(const i of t.dependencies)yield c(this,k,"m",gt).call(this,i,e)})},Ut=function(t){return S(this,void 0,void 0,function*(){yield Promise.all(t.relatedApps.map(e=>this.loadApp(e)))})};const Ye={},ht="DEFAULT_BUS",_t=(t=ht)=>{let e=null,i=!1;const r=((n=ht)=>window.RALLIE_BUS_STORE&&window.RALLIE_BUS_STORE[n])(t);return r?(e=r,i=!1):(e=((n=ht)=>{if(window.RALLIE_BUS_STORE===void 0&&Reflect.defineProperty(window,"RALLIE_BUS_STORE",{value:Ye,writable:!1}),window.RALLIE_BUS_STORE[n])throw new Error(Ve(n));{const s=new Xe(n);return Reflect.defineProperty(window.RALLIE_BUS_STORE,n,{value:s,writable:!1}),s}})(t),i=!0),[e,i]},y={privateBus:t=>`${t}.bus`,stateNamespace:t=>`${t}.state`,isGlobalBusAccessible:"isGlobalBusAccessible",exportMethodName:"__RallieInnerExport__"},ut=t=>`[rallie] ${t}`,rt={stateNotInitialized:t=>ut(` the block ${t}'s state is not initialized, please check:
1. whether the block ${t} is loaded.
2. whether the block ${t} has initialized the state`),duplicatedBlockName:t=>ut(`the block ${t} is already registered before, please rename your block`),stateIsReadonly:t=>ut(`the state of ${t} is readonly`)},Ct=(t,e)=>new Proxy(t,{get:(i,r)=>(...n)=>(0,i[r])(n,e),set:()=>!1}),se=t=>{const e={};return Object.entries(t).forEach(([i,r])=>{e[i]=(n,s)=>r.call({trigger:s},...n)}),e};var w,R,F,T,H,N,K;class Vt{constructor(e,i,r){w.set(this,void 0),this.name=e,M(this,w,r,"f");const n=f(this,w,"f").createBroadcaster(),s=f(this,w,"f").createUnicaster();this.events=Ct(n,i),this.methods=Ct(s,i),Reflect.defineProperty(this,"state",{get:()=>f(this,w,"f").getState(y.stateNamespace(this.name)),set:()=>{throw new Error(rt.stateIsReadonly(this.name))}})}setState(e,i){if(f(this,w,"f").existState(y.stateNamespace(this.name)))return f(this,w,"f").setState(y.stateNamespace(this.name),e,i);throw new Error(rt.stateNotInitialized(this.name))}watchState(e){if(f(this,w,"f").existState(y.stateNamespace(this.name)))return f(this,w,"f").watchState(y.stateNamespace(this.name),e);throw new Error(rt.stateNotInitialized(this.name))}listenEvents(e){return f(this,w,"f").onBroadcast(se(e))}}w=new WeakMap;class Ze extends Vt{constructor(e,i,r,n){const[s]=_t(y.privateBus(e)),o=s.createSocket();super(e,e,o),R.set(this,void 0),F.set(this,void 0),T.set(this,void 0),H.set(this,void 0),N.set(this,void 0),K.set(this,{}),M(this,H,o,"f"),M(this,R,i,"f"),M(this,F,r,"f"),M(this,N,i.createApp(e),"f"),M(this,T,n,"f")}initState(e,i){return f(this,H,"f").initState(y.stateNamespace(this.name),e,i),this}addMethods(e){return f(this,H,"f").onUnicast(se(e))}relyOn(e){return f(this,N,"f").relyOn(e),this}relateTo(e){return f(this,N,"f").relateTo(e),this}onActivate(e){return f(this,N,"f").onActivate(e),this}connect(e){if(!f(this,K,"f")[e]){const[i]=_t(y.privateBus(e)),r=i.createSocket();f(this,K,"f")[e]=new Vt(e,this.name,r)}return f(this,K,"f")[e]}load(e){return f(this,R,"f").loadApp(e)}activate(e){return f(this,R,"f").activateApp(e)}run(e){var i;return ce(this,void 0,void 0,function*(){const r=f(this,T,"f")||((i=f(this,F,"f").getState(y.isGlobalBusAccessible))===null||i===void 0?void 0:i.value),n=a=>{f(this,T,"f")&&f(this,F,"f").setState(y.isGlobalBusAccessible,a?"unfreeze the enviroment":"freeze the enviroment",h=>{h.value=a})},s={isEntry:f(this,T,"f"),use:a=>{r&&f(this,R,"f").use(a)},config:a=>{r&&f(this,R,"f").config(a)},freeze:()=>{n(!1)},unfreeze:()=>{n(!0)}},o=e(new Proxy(s,{get:(a,h,l)=>h==="conf"?JSON.parse(JSON.stringify(f(this,R,"f").conf)):Reflect.get(a,h,l),set:()=>!1}));yield Promise.resolve(o)})}}function ti(t){const[e,i]=_t();if(e.existApp(t))throw new Error(rt.duplicatedBlockName(t));const r=e.createSocket();return i&&r.initState(y.isGlobalBusAccessible,{value:!0},!0),new Ze(t,e,r,i)}R=new WeakMap,F=new WeakMap,T=new WeakMap,H=new WeakMap,N=new WeakMap,K=new WeakMap;const nt=ti("ralliejs/demo-plugin").initState({count:0}).relyOn(["core"]).onActivate(async()=>{const t=nt.connect("core");await t.methods.addI18nResources({"zh-CN":()=>x(()=>import("./zh-CN-4c749a29.js"),[],import.meta.url),"en-US":()=>x(()=>import("./en-US-b003600d.js"),[],import.meta.url)}),t.methods.registerSlot("home",()=>x(()=>import("./Home-73448ee2.js"),[],import.meta.url)),t.methods.registerPluginInfo({title:"plugin.title",description:"plugin.description"}),t.methods.addApplication({name:"样例应用",icon:()=>x(()=>import("./BlockOutlinedIcon-9d32e008.js"),[],import.meta.url),locale:"menu.root",path:"demo",hideInBreadcrumb:!0,children:[{index:!0,loader:()=>x(()=>import("./App-8eabc4d4.js"),["./App-8eabc4d4.js","./App-169b06fe.css"],import.meta.url)},{name:"一级菜单",locale:"menu.firstChild",path:"level-1",loader:()=>x(()=>import("./App-8eabc4d4.js"),["./App-8eabc4d4.js","./App-169b06fe.css"],import.meta.url)}]})});nt.run(async t=>{if(t.isEntry){const{loadHtml:e}=await x(()=>import("./index.es-8a047ee8.js"),[],import.meta.url);t.use(e({entries:{core:"https://ralliejs.github.io/open-platform/#core"}})),nt.activate(nt.name)}});export{nt as d};
