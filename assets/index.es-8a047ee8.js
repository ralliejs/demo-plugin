function M(e,o,i,l){return new(i||(i=Promise))(function(H,h){function v(c){try{s(l.next(c))}catch(a){h(a)}}function f(c){try{s(l.throw(c))}catch(a){h(a)}}function s(c){var a;c.done?H(c.value):(a=c.value,a instanceof i?a:new i(function(b){b(a)})).then(v,f)}s((l=l.apply(e,o||[])).next())})}const k=e=>`[@rallie/load-html] ${e}`,T=/^(http:\/\/|https:\/\/|\/\/)([^?#]*)(\?[^?#]+)?(#.+)?/,$=e=>k(`Invalid html path: ${e}`),C=(e,o)=>k(`Can not construct a url by the base '${e}' and the path '${o}'`),w=e=>{const o=Array.from(e.attributes),i=document.createElement(e.tagName);return o.forEach(l=>{i.setAttribute(l.name,l.value)}),i.innerHTML=e.innerHTML,i},P=(e={})=>(o,i)=>M(void 0,void 0,void 0,function*(){var l;const H=(l=e.fetch)!==null&&l!==void 0?l:window.fetch;o.loadHtml=v=>M(void 0,void 0,void 0,function*(){var f,s;const c=(s=(f=o.regardHtmlPathAsRoot)!==null&&f!==void 0?f:e.regardHtmlPathAsRoot)!==null&&s!==void 0&&s,a=yield H(v),b=yield a.text(),[E,L]=(n=>{const r=T.exec(n);if(r)return[r[0],r[4]||null];throw new Error($(n))})(v),{root:A,scripts:x,links:S,styles:q}=((n,r,u)=>{const d=document.createElement("html");d.innerHTML=n;const m=Array.from(d.querySelectorAll("script")).map(t=>w(t)).map(t=>{const y=t.getAttribute("src");return u&&y&&t.setAttribute("src",u(y)),t}),p=Array.from(d.querySelectorAll("link")).map(t=>w(t)).map(t=>{const y=t.getAttribute("href");return u&&y&&t.setAttribute("href",u(y)),t}),g=Array.from(d.querySelectorAll("style")).map(t=>w(t));return{root:r?d.querySelector(r):null,scripts:m,links:p,styles:g}})(b,L,n=>((r,u,d=!1)=>{if(/^(http:\/\/|https:\/\/|\/\/).+/.test(r))return r;const m=T.exec(u);if(m){const p=m[1],g=m[2];d&&r.startsWith("/")&&(r=r.slice(1));let t="";return t=new URL(r,(p==="//"?"http://":p)+g).href,p==="//"&&(t=t.slice(5)),t}return console.error(C(u,r)),""})(n,E,c));for(const n of q)document.head.appendChild(n);for(const n of S)o.loadLink(n);if(A){const n=document.querySelector(L);n?n.innerHTML=A.innerHTML:document.body.appendChild(A)}for(const n of x)yield o.loadScript(n);return!!(x.length+S.length+q.length)||!!A});const h=(e.entries||{})[o.name];h?yield o.loadHtml(h):yield i()});export{P as default,P as loadHtml};
