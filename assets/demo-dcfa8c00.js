const ie="modulepreload",se=function(t,e){return new URL(t,e).href},At={},N=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=se(s,r),s in At)return;At[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const p=i[u];if(p.href===s&&(!a||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const l=document.createElement("link");if(l.rel=a?"stylesheet":ie,a||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),a)return new Promise((u,p)=>{l.addEventListener("load",u),l.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};function oe(t,e,n,r){return new(n||(n=Promise))(function(i,s){function a(l){try{h(r.next(l))}catch(u){s(u)}}function o(l){try{h(r.throw(l))}catch(u){s(u)}}function h(l){var u;l.done?i(l.value):(u=l.value,u instanceof n?u:new n(function(p){p(u)})).then(a,o)}h((r=r.apply(t,e||[])).next())})}function f(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function M(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n}function S(t,e,n,r){return new(n||(n=Promise))(function(i,s){function a(l){try{h(r.next(l))}catch(u){s(u)}}function o(l){try{h(r.throw(l))}catch(u){s(u)}}function h(l){var u;l.done?i(l.value):(u=l.value,u instanceof n?u:new n(function(p){p(u)})).then(a,o)}h((r=r.apply(t,e||[])).next())})}function c(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function $(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n}const ae=Object.assign,ce=Object.prototype.hasOwnProperty,it=(t,e)=>ce.call(t,e),P=Array.isArray,et=t=>Dt(t)==="[object Map]",gt=t=>typeof t=="symbol",ot=t=>t!==null&&typeof t=="object",le=Object.prototype.toString,Dt=t=>le.call(t),he=t=>Dt(t).slice(8,-1),bt=t=>typeof t=="string"&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Vt=(t,e)=>!Object.is(t,e),ue=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let fe;function Gt(t,e=fe){e&&e.active&&e.effects.push(t)}const Ft=t=>{const e=new Set(t);return e.w=0,e.n=0,e},Ht=t=>(t.w&O)>0,Jt=t=>(t.n&O)>0,ut=new WeakMap;let z=0,O=1;const ft=30;let b;const x=Symbol(""),dt=Symbol("");class de{constructor(e,n=null,r){this.fn=e,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,Gt(this,r)}run(){if(!this.active)return this.fn();let e=b,n=B;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=b,b=this,B=!0,O=1<<++z,z<=ft?(({deps:r})=>{if(r.length)for(let i=0;i<r.length;i++)r[i].w|=O})(this):Ot(this),this.fn()}finally{z<=ft&&(r=>{const{deps:i}=r;if(i.length){let s=0;for(let a=0;a<i.length;a++){const o=i[a];Ht(o)&&!Jt(o)?o.delete(r):i[s++]=o,o.w&=~O,o.n&=~O}i.length=s}})(this),O=1<<--z,b=this.parent,B=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){b===this?this.deferStop=!0:this.active&&(Ot(this),this.onStop&&this.onStop(),this.active=!1)}}function Ot(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}let B=!0;const Pt=[];function _(t,e,n){if(B&&b){let r=ut.get(t);r||ut.set(t,r=new Map);let i=r.get(n);i||r.set(n,i=Ft()),function(s,a){let o=!1;z<=ft?Jt(s)||(s.n|=O,o=!Ht(s)):o=!s.has(b),o&&(s.add(b),b.deps.push(s))}(i)}}function L(t,e,n,r,i,s){const a=ut.get(t);if(!a)return;let o=[];if(e==="clear")o=[...a.values()];else if(n==="length"&&P(t)){const h=ue(r);a.forEach((l,u)=>{(u==="length"||u>=h)&&o.push(l)})}else switch(n!==void 0&&o.push(a.get(n)),e){case"add":P(t)?bt(n)&&o.push(a.get("length")):(o.push(a.get(x)),et(t)&&o.push(a.get(dt)));break;case"delete":P(t)||(o.push(a.get(x)),et(t)&&o.push(a.get(dt)));break;case"set":et(t)&&o.push(a.get(x))}if(o.length===1)o[0]&&Lt(o[0]);else{const h=[];for(const l of o)l&&h.push(...l);Lt(Ft(h))}}function Lt(t,e){const n=P(t)?t:[...t];for(const r of n)r.computed&&Wt(r);for(const r of n)r.computed||Wt(r)}function Wt(t,e){(t!==b||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const pe=function(t,e){const n=Object.create(null),r=t.split(",");for(let i=0;i<r.length;i++)n[r[i]]=!0;return e?i=>!!n[i.toLowerCase()]:i=>!!n[i]}("__proto__,__v_isRef,__isVue"),Kt=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(gt)),we=qt(),ve=qt(!0),$t=function(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...n){const r=d(this);for(let s=0,a=this.length;s<a;s++)_(r,"get",s+"");const i=r[e](...n);return i===-1||i===!1?r[e](...n.map(d)):i}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...n){Pt.push(B),B=!1;const r=d(this)[e].apply(this,n);return function(){const i=Pt.pop();B=i===void 0||i}(),r}}),t}();function qt(t=!1,e=!1){return function(n,r,i){if(r==="__v_isReactive")return!t;if(r==="__v_isReadonly")return t;if(r==="__v_isShallow")return e;if(r==="__v_raw"&&i===(t?e?Ae:Yt:e?Re:Xt).get(n))return n;const s=P(n);if(!t&&s&&it($t,r))return Reflect.get($t,r,i);const a=Reflect.get(n,r,i);return(gt(r)?Kt.has(r):pe(r))?a:(t||_(n,"get",r),e?a:U(a)?s&&bt(r)?a:a.value:ot(a)?t?K(a):St(a):a)}}const me={get:we,set:function(t=!1){return function(e,n,r,i){let s=e[n];if(pt(s)&&U(s)&&!U(r))return!1;if(!t&&(function(h){return!(!h||!h.__v_isShallow)}(r)||pt(r)||(s=d(s),r=d(r)),!P(e)&&U(s)&&!U(r)))return s.value=r,!0;const a=P(e)&&bt(n)?Number(n)<e.length:it(e,n),o=Reflect.set(e,n,r,i);return e===d(i)&&(a?Vt(r,s)&&L(e,"set",n,r):L(e,"add",n,r)),o}}(),deleteProperty:function(t,e){const n=it(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&n&&L(t,"delete",e,void 0),r},has:function(t,e){const n=Reflect.has(t,e);return gt(e)&&Kt.has(e)||_(t,"has",e),n},ownKeys:function(t){return _(t,"iterate",P(t)?"length":x),Reflect.ownKeys(t)}},ye={get:ve,set:(t,e)=>!0,deleteProperty:(t,e)=>!0},Et=t=>t,at=t=>Reflect.getPrototypeOf(t);function q(t,e,n=!1,r=!1){const i=d(t=t.__v_raw),s=d(e);n||(e!==s&&_(i,"get",e),_(i,"get",s));const{has:a}=at(i),o=r?Et:n?Rt:kt;return a.call(i,e)?o(t.get(e)):a.call(i,s)?o(t.get(s)):void(t!==i&&t.get(e))}function Q(t,e=!1){const n=this.__v_raw,r=d(n),i=d(t);return e||(t!==i&&_(r,"has",t),_(r,"has",i)),t===i?n.has(t):n.has(t)||n.has(i)}function X(t,e=!1){return t=t.__v_raw,!e&&_(d(t),"iterate",x),Reflect.get(t,"size",t)}function xt(t){t=d(t);const e=d(this);return at(e).has.call(e,t)||(e.add(t),L(e,"add",t,t)),this}function Bt(t,e){e=d(e);const n=d(this),{has:r,get:i}=at(n);let s=r.call(n,t);s||(t=d(t),s=r.call(n,t));const a=i.call(n,t);return n.set(t,e),s?Vt(e,a)&&L(n,"set",t,e):L(n,"add",t,e),this}function Mt(t){const e=d(this),{has:n,get:r}=at(e);let i=n.call(e,t);i||(t=d(t),i=n.call(e,t)),r&&r.call(e,t);const s=e.delete(t);return i&&L(e,"delete",t,void 0),s}function jt(){const t=d(this),e=t.size!==0,n=t.clear();return e&&L(t,"clear",void 0,void 0),n}function Y(t,e){return function(n,r){const i=this,s=i.__v_raw,a=d(s),o=e?Et:t?Rt:kt;return!t&&_(a,"iterate",x),s.forEach((h,l)=>n.call(r,o(h),o(l),i))}}function Z(t,e,n){return function(...r){const i=this.__v_raw,s=d(i),a=et(s),o=t==="entries"||t===Symbol.iterator&&a,h=t==="keys"&&a,l=i[t](...r),u=n?Et:e?Rt:kt;return!e&&_(s,"iterate",h?dt:x),{next(){const{value:p,done:ct}=l.next();return ct?{value:p,done:ct}:{value:o?[u(p[0]),u(p[1])]:u(p),done:ct}},[Symbol.iterator](){return this}}}}function R(t){return function(...e){return t!=="delete"&&this}}const[_e,ge,be,Ee]=function(){const t={get(i){return q(this,i)},get size(){return X(this)},has:Q,add:xt,set:Bt,delete:Mt,clear:jt,forEach:Y(!1,!1)},e={get(i){return q(this,i,!1,!0)},get size(){return X(this)},has:Q,add:xt,set:Bt,delete:Mt,clear:jt,forEach:Y(!1,!0)},n={get(i){return q(this,i,!0)},get size(){return X(this,!0)},has(i){return Q.call(this,i,!0)},add:R("add"),set:R("set"),delete:R("delete"),clear:R("clear"),forEach:Y(!0,!1)},r={get(i){return q(this,i,!0,!0)},get size(){return X(this,!0)},has(i){return Q.call(this,i,!0)},add:R("add"),set:R("set"),delete:R("delete"),clear:R("clear"),forEach:Y(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(i=>{t[i]=Z(i,!1,!1),n[i]=Z(i,!0,!1),e[i]=Z(i,!1,!0),r[i]=Z(i,!0,!0)}),[t,n,e,r]}();function Qt(t,e){const n=e?t?Ee:be:t?ge:_e;return(r,i,s)=>i==="__v_isReactive"?!t:i==="__v_isReadonly"?t:i==="__v_raw"?r:Reflect.get(it(n,i)&&i in r?n:r,i,s)}const Se={get:Qt(!1,!1)},ke={get:Qt(!0,!1)},Xt=new WeakMap,Re=new WeakMap,Yt=new WeakMap,Ae=new WeakMap;function St(t){return pt(t)?t:Zt(t,!1,me,Se,Xt)}function K(t){return Zt(t,!0,ye,ke,Yt)}function Zt(t,e,n,r,i){if(!ot(t)||t.__v_raw&&(!e||!t.__v_isReactive))return t;const s=i.get(t);if(s)return s;const a=(o=t).__v_skip||!Object.isExtensible(o)?0:function(l){switch(l){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(he(o));var o;if(a===0)return t;const h=new Proxy(t,a===2?r:n);return i.set(t,h),h}function pt(t){return!(!t||!t.__v_isReadonly)}function d(t){const e=t&&t.__v_raw;return e?d(e):t}const kt=t=>ot(t)?St(t):t,Rt=t=>ot(t)?K(t):t;function U(t){return!(!t||t.__v_isRef!==!0)}const Oe=t=>`[@rallie/core] you are trying to remove a listener of the broadcast event ${t}, but ${t} hasn't been registed as a broadcast event`,Pe=t=>`[@rallie/core] you are trying to remove a listener of the broadcast event ${t}, but the listener hasn't been registed`,Le=t=>`[@rallie/core] one of the callbacks of the broadcast event ${t} throws an uncaught error`,We=t=>`[@rallie/core] you are trying to remove a listener of the unicast event ${t}, but ${t} hasn't been registed as a unicast event`,$e=t=>`[@rallie/core] you are trying to register a unicast event ${t}, but it has been registered before`,xe=t=>`[@rallie/core] you have emitted ${t} unicast, but there is no listener of this event`,Be=t=>`[@rallie/core] ${t} is existing, you are not allowed to create it again`,Me=(t,e)=>`[@rallie/core] can not find any assets of the app ${t} on the bus ${e}`,je=t=>`[@rallie/core] you are trying to activate app ${t}, but it was not created`,Te=t=>`[@rallie/core] state ${t} is private, you are not allowed to set it`,Ne=t=>`[@rallie/core] please describe your action when you modify the state ${t}`,te=t=>`[@rallie/core] it's not allowed to set or watch state ${t} before it is initialized`,ze=t=>`[@rallie/core] duplicated initialized state ${t}`,Ue=t=>`[@rallie/core] it's not allowed to initialized state ${t} to a primitive value`,Ie=t=>`[@rallie/core] the bus named ${t} has been defined before, please rename your bus`,Ce=(t,e)=>`[@rallie/core] There is a circular dependency when activating the app ${t}, and the circular path is ${e.join("->")}`,De=()=>"[@rallie/core] next() called multiple times in the middleware",Ve=()=>"[@rallie/core] the middleware must be a function",Ge=(t,e)=>`[@rallie/core] the event ${t} is not in the events pool that you specified when calling on${e?"Unicast":"Broadcast"}`,Tt=t=>(e,n)=>{let r=-1;const i=s=>{if(s<=r)return Promise.reject(new Error(De()));r=s;let a=t[s];if(s===t.length&&(a=n),!a)return Promise.resolve();try{return Promise.resolve(a(e,i.bind(null,s+1)))}catch(o){return Promise.reject(o)}};return i(0)};var E,W,nt,I,C,v,g,wt,ee;class Fe{constructor(){E.set(this,{}),W.set(this,{})}addBroadcastEventListener(e,n){c(this,E,"f")[e]=c(this,E,"f")[e]||new Set,c(this,E,"f")[e].add(n)}addUnicastEventListener(e,n){if(c(this,W,"f")[e])throw new Error($e(e));c(this,W,"f")[e]=n}removeBroadcastEventListener(e,n){const r=c(this,E,"f")[e];if(!r){const i=Oe(e);throw new Error(i)}if(!r.has(n)){const i=Pe(e);throw new Error(i)}r.delete(n)}removeUnicastEventListener(e){if(!c(this,W,"f")[e]){const n=We(e);throw new Error(n)}delete c(this,W,"f")[e]}emitBroadcast(e,...n){c(this,E,"f")[e]=c(this,E,"f")[e]||new Set,c(this,E,"f")[e].forEach(r=>{try{r(...n)}catch(i){console.error(Le(e)),console.error(i)}})}emitUnicast(e,...n){const r=c(this,W,"f")[e];if(r)return r(...n);throw new Error(xe(e))}}E=new WeakMap,W=new WeakMap;class He{constructor(e,n){nt.set(this,void 0),I.set(this,void 0),$(this,nt,e,"f"),$(this,I,n,"f"),c(this,I,"f")[e].watchers.add(this)}do(e){return this.handler=e,()=>this.unwatch()}unwatch(){this==null||this.stopEffect(),this.handler=null;const e=c(this,I,"f")[c(this,nt,"f")].watchers;e.has(this)&&e.delete(this)}}nt=new WeakMap,I=new WeakMap;class Je{constructor(e,n){C.add(this),v.set(this,void 0),g.set(this,void 0),$(this,v,e,"f"),$(this,g,n,"f")}onBroadcast(e){return Object.entries(e).forEach(([n,r])=>{c(this,v,"f").addBroadcastEventListener(n,r)}),n=>{c(this,C,"m",wt).call(this,e,!1,n)}}onUnicast(e){return Object.entries(e).forEach(([n,r])=>{try{c(this,v,"f").addUnicastEventListener(n,r)}catch(i){console.error(i)}}),n=>{c(this,C,"m",wt).call(this,e,!0,n)}}createBroadcaster(e){return new Proxy({},{get:(n,r)=>(...i)=>(e==null||e(r),c(this,v,"f").emitBroadcast(r,...i)),set:()=>!1})}createUnicaster(e){return new Proxy({},{get:(n,r)=>(...i)=>(e==null||e(r),c(this,v,"f").emitUnicast(r,...i)),set:()=>!1})}existState(e){return!!c(this,g,"f")[e]}initState(e,n,r=!1){if(this.existState(e))throw new Error(ze(e));if(["string","number","boolean","undefined"].includes(typeof n))throw new Error(Ue(e));return c(this,g,"f")[e]={state:St(n),owner:r?this:null,watchers:new Set},c(this,v,"f").emitBroadcast("$state-initialized",e),this.getState(e)}getState(e,n){if(this.existState(e)){const r=K(c(this,g,"f")[e].state);return n?n(r):r}return null}setState(e,n,r){return S(this,void 0,void 0,function*(){const i=c(this,C,"m",ee).call(this,e);if(!n)throw new Error(Ne(e));{const s=r(i);yield Promise.resolve(s)}})}watchState(e,n){if(!this.existState(e)){const o=te(e);throw new Error(o)}let r=!1;const i=K(c(this,g,"f")[e].state),s=new He(e,c(this,g,"f")),a=function(o,h){o.effect&&(o=o.effect.fn);const l=new de(o);h&&(ae(l,h),h.scope&&Gt(l,h.scope)),h&&h.lazy||l.run();const u=l.run.bind(l);return u.effect=l,u}(()=>n(i),{lazy:!0,scheduler:()=>{r||(r=!0,Promise.resolve().then(()=>{var o;const h=d(n(i));(o=s.handler)===null||o===void 0||o.call(s,h,s.oldWatchingStates),s.oldWatchingStates=d(h),r=!1}))}});return s.oldWatchingStates=a(),s.stopEffect=()=>a.effect.stop(),s}}v=new WeakMap,g=new WeakMap,C=new WeakSet,wt=function(t,e,n){let r=e?c(this,v,"f").removeUnicastEventListener:c(this,v,"f").removeBroadcastEventListener;r=r.bind(c(this,v,"f")),n?t[n]?(r(n,t[n]),delete t[n]):console.warn(Ge(n,e)):Object.entries(t).forEach(([i,s])=>{r(i,s)})},ee=function(t){if(!this.existState(t)){const n=te(t);throw new Error(n)}const e=c(this,g,"f")[t].owner;if(e!==this&&e!==null){const n=Te(t);throw new Error(n)}return c(this,g,"f")[t].state};class Ke{constructor(e){this.name=e,this.activated=null,this.dependencies=[],this.relatedApps=[],this.name=e,this.isRallieCoreApp=!0}relateTo(e){return this.relatedApps=Array.from(new Set([...this.relatedApps,...e])),this}relyOn(e){return this.relateTo(e),this.dependencies=Array.from(new Set([...this.dependencies,...e])),this}onActivate(e){return this.doActivate=e,this}}var k,st,vt,mt,m,D,V,G,Nt,ne,re,yt,zt,Ut,tt={loadScript:t=>S(void 0,void 0,void 0,function*(){return new Promise(e=>{let n=null;t instanceof HTMLScriptElement?n=t:(n=document.createElement("script"),Object.entries(typeof t!="string"?t:{type:"text/javascript",src:t}).forEach(([i,s])=>{n.setAttribute(i,s)})),n.src&&(n.onload=n.onerror=()=>{e()}),document.body.appendChild(n),n.src||e()})}),loadLink:t=>{let e=null;if(t instanceof HTMLLinkElement)e=t;else{const n=typeof t!="string"?t:{rel:"stylesheet",type:"text/css",href:t};e=document.createElement("link"),Object.entries(n).forEach(([r,i])=>{e.setAttribute(r,i)})}document.head.appendChild(e)}};class qe{constructor(e){k.add(this),st.set(this,void 0),vt.set(this,new Fe),mt.set(this,{}),m.set(this,{}),D.set(this,{}),this.conf=K({assets:{}}),V.set(this,[]),G.set(this,void 0),$(this,st,e,"f"),$(this,G,Tt(c(this,V,"f")),"f")}createSocket(){return new Je(c(this,vt,"f"),c(this,mt,"f"))}existApp(e){return!!c(this,m,"f")[e]}createApp(e){if(this.existApp(e))throw new Error(Be(e));const n=new Ke(e);return c(this,m,"f")[e]=n,n}loadApp(e){return S(this,void 0,void 0,function*(){c(this,m,"f")[e]||(c(this,D,"f")[e]||(c(this,D,"f")[e]=new Promise((n,r)=>{const i=c(this,k,"m",ne).call(this,e);c(this,G,"f").call(this,i,c(this,k,"m",re).bind(this)).then(()=>{e.startsWith("lib:")&&!c(this,m,"f")[e]&&(c(this,m,"f")[e]=!0),c(this,m,"f")[e]||r(new Error(je(e))),n()}).catch(s=>{r(s)})})),yield c(this,D,"f")[e])})}activateApp(e){return S(this,void 0,void 0,function*(){yield c(this,k,"m",yt).call(this,e,[])})}config(e){return this.conf=Object.assign(Object.assign(Object.assign({},this.conf),e),{assets:Object.assign(Object.assign({},this.conf.assets),(e==null?void 0:e.assets)||{})}),this}use(e){if(typeof e!="function")throw new Error(Ve());return c(this,V,"f").push(e),$(this,G,Tt(c(this,V,"f")),"f"),this}}st=new WeakMap,vt=new WeakMap,mt=new WeakMap,m=new WeakMap,D=new WeakMap,V=new WeakMap,G=new WeakMap,k=new WeakSet,Nt=function(t){return c(this,m,"f")[t]&&typeof c(this,m,"f")[t]!="boolean"},ne=function(t){return{name:t,loadScript:tt.loadScript,loadLink:tt.loadLink}},re=function(t){return S(this,void 0,void 0,function*(){const{name:e,loadScript:n=tt.loadScript,loadLink:r=tt.loadLink}=t,{assets:i}=this.conf;if(!i[e])throw new Error(Me(e,c(this,st,"f")));if(i[e].css&&i[e].css.forEach(s=>{r(s)}),i[e].js)for(const s of i[e].js)yield n(s)})},yt=function(t,e){return S(this,void 0,void 0,function*(){if(yield this.loadApp(t),c(this,k,"m",Nt).call(this,t)){const n=c(this,m,"f")[t];if(yield c(this,k,"m",Ut).call(this,n),e.includes(t)){const r=e.indexOf(t),i=[...e.slice(r),t];throw new Error(Ce(t,i))}if(e.push(t),!n.activated){const r=()=>S(this,void 0,void 0,function*(){yield c(this,k,"m",zt).call(this,n,e),n.doActivate&&(yield Promise.resolve(n.doActivate()))});n.activated=r()}yield n.activated,e.pop()}})},zt=function(t,e){return S(this,void 0,void 0,function*(){if(t.dependencies.length!==0)for(const n of t.dependencies)yield c(this,k,"m",yt).call(this,n,e)})},Ut=function(t){return S(this,void 0,void 0,function*(){yield Promise.all(t.relatedApps.map(e=>this.loadApp(e)))})};const Qe={},lt="DEFAULT_BUS",_t=(t=lt)=>{let e=null,n=!1;const r=((i=lt)=>window.RALLIE_BUS_STORE&&window.RALLIE_BUS_STORE[i])(t);return r?(e=r,n=!1):(e=((i=lt)=>{if(window.RALLIE_BUS_STORE===void 0&&Reflect.defineProperty(window,"RALLIE_BUS_STORE",{value:Qe,writable:!1}),window.RALLIE_BUS_STORE[i])throw new Error(Ie(i));{const s=new qe(i);return Reflect.defineProperty(window.RALLIE_BUS_STORE,i,{value:s,writable:!1}),s}})(t),n=!0),[e,n]},y={privateBus:t=>`${t}.bus`,stateNamespace:t=>`${t}.state`,isGlobalBusAccessible:"isGlobalBusAccessible",exportMethodName:"__RallieInnerExport__"},ht=t=>`[rallie] ${t}`,rt={stateNotInitialized:t=>ht(` the block ${t}'s state is not initialized, please check:
1. whether the block ${t} is loaded.
2. whether the block ${t} has initialized the state`),duplicatedBlockName:t=>ht(`the block ${t} is already registered before, please rename your block`),stateIsReadonly:t=>ht(`the state of ${t} is readonly`)};var w,A,F,j,H,T,J;class It{constructor(e,n){w.set(this,void 0),this.name=e,M(this,w,n,"f"),this.events=f(this,w,"f").createBroadcaster(),this.methods=f(this,w,"f").createUnicaster(),Reflect.defineProperty(this,"state",{get:()=>f(this,w,"f").getState(y.stateNamespace(this.name)),set:()=>{throw new Error(rt.stateIsReadonly(this.name))}})}setState(e,n){if(f(this,w,"f").existState(y.stateNamespace(this.name)))return f(this,w,"f").setState(y.stateNamespace(this.name),e,n);throw new Error(rt.stateNotInitialized(this.name))}watchState(e){if(f(this,w,"f").existState(y.stateNamespace(this.name)))return f(this,w,"f").watchState(y.stateNamespace(this.name),e);throw new Error(rt.stateNotInitialized(this.name))}listenEvents(e){return f(this,w,"f").onBroadcast(e)}}w=new WeakMap;class Xe extends It{constructor(e,n,r,i){const[s]=_t(y.privateBus(e)),a=s.createSocket();super(e,a),A.set(this,void 0),F.set(this,void 0),j.set(this,void 0),H.set(this,void 0),T.set(this,void 0),J.set(this,{}),M(this,H,a,"f"),M(this,A,n,"f"),M(this,F,r,"f"),M(this,T,n.createApp(e),"f"),M(this,j,i,"f")}initState(e,n){return f(this,H,"f").initState(y.stateNamespace(this.name),e,n),this}addMethods(e){return f(this,H,"f").onUnicast(e)}relyOn(e){return f(this,T,"f").relyOn(e),this}relateTo(e){return f(this,T,"f").relateTo(e),this}onActivate(e){return f(this,T,"f").onActivate(e),this}connect(e){if(!f(this,J,"f")[e]){const[n]=_t(y.privateBus(e)),r=n.createSocket();f(this,J,"f")[e]=new It(e,r)}return f(this,J,"f")[e]}load(e){return f(this,A,"f").loadApp(e)}activate(e){return f(this,A,"f").activateApp(e)}run(e){var n;return oe(this,void 0,void 0,function*(){const r=f(this,j,"f")||((n=f(this,F,"f").getState(y.isGlobalBusAccessible))===null||n===void 0?void 0:n.value),i=o=>{f(this,j,"f")&&f(this,F,"f").setState(y.isGlobalBusAccessible,o?"unfreeze the enviroment":"freeze the enviroment",h=>{h.value=o})},s={isEntry:f(this,j,"f"),use:o=>{r&&f(this,A,"f").use(o)},config:o=>{r&&f(this,A,"f").config(o)},freeze:()=>{i(!1)},unfreeze:()=>{i(!0)}},a=e(new Proxy(s,{get:(o,h,l)=>h==="conf"?JSON.parse(JSON.stringify(f(this,A,"f").conf)):Reflect.get(o,h,l),set:()=>!1}));yield Promise.resolve(a)})}}function Ye(t){const[e,n]=_t();if(e.existApp(t))throw new Error(rt.duplicatedBlockName(t));const r=e.createSocket();return n&&r.initState(y.isGlobalBusAccessible,{value:!0},!0),new Xe(t,e,r,n)}A=new WeakMap,F=new WeakMap,j=new WeakMap,H=new WeakMap,T=new WeakMap,J=new WeakMap;const Ct=Ye("demo").initState({count:0}).relyOn(["core"]).onActivate(async()=>{const t=Ct.connect("core");if(t.setState("注册首页",e=>{e.slot.home=()=>N(()=>import("./Home-d260b1ce.js"),["./Home-d260b1ce.js","./react-0b8f741d.js"],import.meta.url)}),t.setState("注册应用",e=>{e.applications.push({name:"测试应用",locale:"demo:menu.root",path:"demo",children:[{index:!0,loader:()=>N(()=>import("./App-6871fb4a.js"),["./App-6871fb4a.js","./react-0b8f741d.js","./App-19634022.css"],import.meta.url)},{name:"菜单1",locale:"demo:menu.firstChild",path:"level-1",loader:()=>N(()=>import("./App-6871fb4a.js"),["./App-6871fb4a.js","./react-0b8f741d.js","./App-19634022.css"],import.meta.url)}]})}),await t.methods.addI18nResource(Ct.name,{"zh-CN":()=>N(()=>import("./zh-CN-7d02853d.js"),[],import.meta.url),"en-US":()=>N(()=>import("./en-US-e609e853.js"),[],import.meta.url)}),!t.state.root){const e=document.createElement("div");document.body.appendChild(e),t.setState("挂载root",n=>{n.root=e})}});export{N as _,Ct as d};
